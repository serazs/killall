--[=[
  NPC Hasar Aura - Sadece NPC'lere hasar verir
  - Oyuncuları etkilemez
  - Mesafe ayarlı
  - Aç/kapa butonu
]=]

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local lp = Players.LocalPlayer

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "NPCDamageAura"
gui.Parent = lp:WaitForChild("PlayerGui")
gui.ResetOnSpawn = false

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 200, 0, 120)
frame.Position = UDim2.new(0.5, -100, 0.5, -60)
frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
frame.Active = true
frame.Draggable = true
frame.Parent = gui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.Text = "NPC HASAR"
title.TextColor3 = Color3.fromRGB(100, 200, 255)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.Parent = frame

local btn = Instance.new("TextButton")
btn.Size = UDim2.new(0.8, 0, 0, 35)
btn.Position = UDim2.new(0.1, 0, 0.35, 0)
btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
btn.Text = "HASAR AÇ"
btn.TextColor3 = Color3.fromRGB(255, 255, 255)
btn.Font = Enum.Font.GothamBold
btn.TextSize = 14
btn.Parent = frame

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 6)
btnCorner.Parent = btn

-- Slider
local sliderBg = Instance.new("Frame")
sliderBg.Size = UDim2.new(0.8, 0, 0, 20)
sliderBg.Position = UDim2.new(0.1, 0, 0.7, 0)
sliderBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
sliderBg.Parent = frame

local sliderCorner = Instance.new("UICorner")
sliderCorner.CornerRadius = UDim.new(0, 4)
sliderCorner.Parent = sliderBg

local sliderFill = Instance.new("Frame")
sliderFill.Size = UDim2.new(0.5, 0, 1, 0)
sliderFill.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
sliderFill.BorderSizePixel = 0
sliderFill.Parent = sliderBg

local fillCorner = Instance.new("UICorner")
fillCorner.CornerRadius = UDim.new(0, 4)
fillCorner.Parent = sliderFill

local distText = Instance.new("TextLabel")
distText.Size = UDim2.new(0.5, 0, 1, 0)
distText.Position = UDim2.new(0.5, 0, 0, 0)
distText.BackgroundTransparency = 1
distText.Text = "20"
distText.TextColor3 = Color3.fromRGB(255, 255, 255)
distText.Font = Enum.Font.Gotham
distText.TextSize = 12
distText.Parent = sliderBg

-- Değişkenler
local active = false
local range = 20
local damageAmount = 50  -- Her vuruşta 50 hasar
local dragging = false

-- Slider işlevi
sliderBg.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
    end
end)

sliderBg.InputChanged:Connect(function(input)
    if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
        local mouseX = input.Position.X
        local bgX = sliderBg.AbsolutePosition.X
        local bgW = sliderBg.AbsoluteSize.X
        local percent = math.clamp((mouseX - bgX) / bgW, 0, 1)
        sliderFill.Size = UDim2.new(percent, 0, 1, 0)
        range = math.floor(5 + percent * 45)
        distText.Text = tostring(range)
    end
end)

sliderBg.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

-- NPC hasar fonksiyonu (oyuncuları hariç tut)
local function damageNPCs()
    local char = lp.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso") or char:FindFirstChild("Head")
    if not root then return end
    local pos = root.Position
    
    -- Tüm modelleri tara
    for _, obj in ipairs(Workspace:GetDescendants()) do
        if obj:IsA("Model") and obj ~= char then
            -- Eğer bu bir oyuncuysa atla
            if Players:GetPlayerFromCharacter(obj) then
                continue
            end
            
            -- Humanoid var mı kontrol et
            local hum = obj:FindFirstChildOfClass("Humanoid")
            if hum and hum.Health > 0 then
                local objRoot = obj:FindFirstChild("HumanoidRootPart") or obj:FindFirstChild("Torso") or obj:FindFirstChild("Head") or obj:FindFirstChildOfClass("Part")
                if objRoot then
                    local dist = (pos - objRoot.Position).Magnitude
                    if dist <= range then
                        hum.Health = hum.Health - damageAmount
                    end
                end
            end
        end
    end
end

-- Döngü (saniyede 10 kez çalışır)
local function loop()
    while active do
        damageNPCs()
        task.wait(0.1)
    end
end

-- Buton
btn.MouseButton1Click:Connect(function()
    active = not active
    if active then
        btn.Text = "HASAR KAPAT"
        btn.BackgroundColor3 = Color3.fromRGB(0, 80, 100)
        coroutine.wrap(loop)()
    else
        btn.Text = "HASAR AÇ"
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    end
end)

-- Bildirim
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "NPC Hasar Aura",
    Text = "Sadece NPC'lere hasar verir",
    Duration = 4
})
